"use strict";var loginCtrlMod=angular.module("LoginCtrlMod",[]);loginCtrlMod.controller("LoginController",["$scope","LoginService","$rootScope","$location","$log","$window","$state","$localStorage",function(c,b,a,h,f,g,e,d){a.authenticated=false;c.loading=false;c.submitLogin=function(){var k={username:angular.lowercase(c.username),password:c.password};c.loading=true;b.submitLogin(k).then(function i(l){d.userData=l.data;a.userData=d.userData;a.onlyMPI=false;a.loggedInUser=a.userData.username;a.authToken=a.userData.token;a.userType=a.userData.usrTypCd;a.userAccess=[];a.userAuthorities=[];a.userPit1ComponentType=[];a.userPit2ComponentType=[];a.isAdmin=a.userData.admin;a.isRegnAdmin=a.userData.regnAdmin;a.allowPaResbatch=a.userData.allowPaResbatch;a.allowVIPsubmit=a.userData.allowVIPsubmit;a.allowVCMSsubmit=a.userData.allowVCMSsubmit;if(a.isAdmin||a.isRegnAdmin){a.userAccess.push(ROLE_PIT1_ACS);a.userAccess.push(ROLE_PIT1_MRCH);a.userAccess.push(ROLE_PIT2_ACS);a.userAccess.push(ROLE_PIT2_MRCH)}else{a.userAccess=a.userData.userAuthorities}if(a.userAccess.length>0){angular.forEach(a.userAccess,function(m){if(m==ROLE_PIT1_ACS||m==ROLE_PIT1_MRCH){if(a.userAuthorities.length>0){if(a.userAuthorities.indexOf("PIT1")==-1){a.userAuthorities.push("PIT1")}}else{a.userAuthorities.push("PIT1")}if(m==ROLE_PIT1_ACS){a.userPit1ComponentType.push("ACS")}if(m==ROLE_PIT1_MRCH){a.userPit1ComponentType.push("MRCH")}}else{if(m==ROLE_PIT2_ACS||m==ROLE_PIT2_MRCH){if(a.userAuthorities.length>0){if(a.userAuthorities.indexOf("PIT2")==-1){a.userAuthorities.push("PIT2")}}else{a.userAuthorities.push("PIT2")}if(m==ROLE_PIT2_ACS){a.userPit2ComponentType.push("ACS")}if(m==ROLE_PIT2_MRCH){a.userPit2ComponentType.push("MRCH")}}}});if(a.userPit2ComponentType.length==1&&a.userPit2ComponentType[0]=="MRCH"){a.onlyMPI=true}else{a.onlyMPI=false}}else{h.path("/noAccess")}if(a.userAuthorities.length>1){h.path("/pit/2.0")}else{if(a.userAuthorities.length==1){if(a.userAuthorities.indexOf("PIT1")!=-1){h.path("/pit/1.0.2")}else{h.path("/pit/2.0")}}}c.loading=false;a.authenticated=true},function j(l){c.username=angular.lowercase(c.username);c.loading=false;h.path("/pit/login")})};c.alertMessage=function(){if(g.confirm("I will agree that I will utilize V3DSTS Results for its own internal purpose and not with a view to disseminating publicity its test results.\nCONFIDENTIALITY:All of the information furnished herein and by the V3DSTS are confidential to VISA and shall not be shared nor distributed by anyone without VISA consent")){c.submitLogin()}else{e.go("login")}};c.clearData=function(){c.loginForm.$setPristine();c.username="";c.password="";a.showErrorAlert=false;a.showSuccessAlert=false}}]);