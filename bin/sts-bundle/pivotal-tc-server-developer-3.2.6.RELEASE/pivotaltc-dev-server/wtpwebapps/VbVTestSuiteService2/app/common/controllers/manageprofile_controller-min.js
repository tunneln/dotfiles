"use strict";var manageProfileMod=angular.module("ManageProfileModule",[]);manageProfileMod.controller("ManageProfileCtrl",["$scope","$rootScope","ManageProfileService","$state","UserEnrollmentService","$window",function(c,a,f,d,b,e){a.isManageProfile=true;c.loading=false;c.components=[{id:"ACS",value:"ACS",selected:false},{id:"Merchant",value:"MRCH",selected:false}];c.pit2components=[{id:"ACS",value:"ACS",selected:false},{id:"3DS Server",value:"MRCH",selected:false}];c.versions=[{id:"PIT2",value:"3DS 2.0",selected:false}];c.tlsVersions=[{id:"TLS12",value:"TLS 1.2",selected:false}];c.admin=false;c.emvCertificate="";c.getCountries=function(){b.getCountries().then(function(g){if(g.statusText=="OK"){c.countries=g.data}else{}})};c.getCountries();c.manageProfile=function(){c.pit1SelectedComponents=[];c.pit2SelectedComponents=[];c.selectedTLSVersions=[];c.selectedTestsDescs=[];c.selectedVersions=[];var g=a.loggedInUser;f.getUserData(g).then(function(h){var i=h.data;c.email=i.emailAddr;c.password=i.password;c.confirmPassword=i.confirmPassword;c.name=i.usrNm;c.company=i.coNm;c.streetAddress=i.str1Addr;c.city=i.cityNm;c.country=i.ctryCd;c.phone=i.phnNum;c.bin=i.bin;c.acsVerificationEnrollUrl=i.acsUrl;c.merchantId=i.mrchId;c.merchantPwd=i.merchPassword;c.merchantConfirmPwd=i.mrchConfirmPassword;c.batchSubmission=i.allowPAResBatchSbum;c.allowVIP=i.allowSubmVIP;c.allowVCMS=i.allowSubmVCMS;c.merchantRefNum=i.mrchRefNum;c.pit2ACSUrl=i.pit2Url;c.mrchPswdEncrptdVal=i.mrchPswdEncrptdVal;c.firstName=i.firstName;c.lastName=i.lastName;c.stateOrTerritory=i.stateORTerritory,c.postalCode=i.postalCode;c.acquirerBin=i.acquirerBin;c.acsReference=i.acsReference;angular.forEach(i.userRoles,function(k){if(k!="ADMIN"){var j=k.split("_");if(c.selectedVersions!=null&&c.selectedVersions.length>0){if(c.selectedVersions.indexOf(j[0])==-1){c.selectedVersions.push(j[0])}}else{c.selectedVersions.push(j[0])}if(j[0]=="PIT1"){c.pit1SelectedComponents.push(j[1])}else{if(j[0]=="PIT2"){c.pit2SelectedComponents.push(j[1])}}}else{c.admin=true}});angular.forEach(c.versions,function(j){if(c.selectedVersions.indexOf(j.id)!=-1){if(j.id=="PIT1"){c.isPIT1=true;j.selected=true}else{if(j.id=="PIT2"){c.PIT2Selected=true;j.selected=true}else{j.selected=false}}}});angular.forEach(c.pit2components,function(j){if(c.pit2SelectedComponents.indexOf(j.value)!=-1){if(j.value==COMPONENTS.ACS){c.isPIT2ACS=true;j.selected=true}else{if(j.value==COMPONENTS.MRCH){c.isMerchant=true;j.selected=true}else{j.selected=false}}}});angular.forEach(c.tlsVersions,function(j){if(i.tlsVersions.indexOf(j.id)!=-1){j.selected=true}});c.selectedTLSVersions=i.tlsVersions;c.pit2Url=i.pit2Url;c.visaComplLetterId=i.visaComplLetterId;c.businessId=i.businessId})};c.manageProfile();c.resetPIT2Data=function(){c.PIT2Selected=false;c.isMerchant=false;c.isPIT2ACS=false;c.pit2ACSUrl="";c.acsReference="";c.merchantRefNum="";c.pit2SelectedComponents=[];angular.forEach(c.pit2components,function(g){g.selected=false})};c.pit2ComponentSelect=function(h){var g=undefined;if(c.pit2SelectedComponents.length>0){angular.forEach(c.pit2SelectedComponents,function(i){if(i==h){g=c.pit2SelectedComponents.indexOf(h)}});if(g!=undefined){c.pit2SelectedComponents.splice(g,1);if(h==COMPONENTS.ACS){c.isPIT2ACS=false;c.pit2ACSUrl="";c.acsReference=""}else{if(h==COMPONENTS.MRCH){c.isMerchant=false;c.merchantRefNum="";c.merchantId=""}}angular.forEach(c.pit2components,function(i){if(i.value==h){i.selected=false}})}else{c.pit2SelectedComponents.push(h);if(h==COMPONENTS.ACS){c.isPIT2ACS=true}else{if(h==COMPONENTS.MRCH){c.isMerchant=true}}}}else{c.pit2SelectedComponents.push(h);if(h==COMPONENTS.ACS){c.isPIT2ACS=true}else{if(h==COMPONENTS.MRCH){c.isMerchant=true}}}};c.tlsVerSelect=function(g){if(c.selectedTLSVersions.length>0){var h=c.selectedTLSVersions.indexOf(g);if(h!=-1){c.selectedTLSVersions.splice(h,1)}else{c.selectedTLSVersions.push(g)}}else{c.selectedTLSVersions.push(g)}angular.forEach(c.tlsVersions,function(i){if(i.id==g){i.selected=!i.selected}})};c.testsDescSelect=function(h){if(c.selectedTestsDescs.length>0){var g=c.selectedTestsDescs.indexOf(h);if(g!=-1){c.selectedTestsDescs.splice(g,1)}else{c.selectedTestsDescs.push(h)}}else{c.selectedTestsDescs.push(h)}angular.forEach(c.tests,function(i){if(i.id==h){i.selected=!i.selected}})};c.updateUserData=function(){console.log("$scope.selectedTestsDescs :: "+c.selectedTestsDescs);console.log("selectedTLSVersions :: "+c.selectedTLSVersions);c.selectedVersions=[];if(c.password!=undefined&&c.confirmPassword!=undefined){if(c.password!==c.confirmPassword){a.showSuccessAlert=false;a.showErrorAlert=true;a.errorMessage="Password and confirm password are not matching";e.scrollTo(0,0);return}}c.userRoles=[];var h=false;c.selectedVersions.push("PIT2");if(c.selectedVersions.length>0){angular.forEach(c.selectedVersions,function(k){if(!h){if(k=="PIT1"){if(c.pit1SelectedComponents!=undefined&&c.pit1SelectedComponents.length>0){c.versionComponents=c.pit1SelectedComponents}else{a.showSuccessAlert=false;a.showErrorAlert=true;a.errorMessage="Components (must specify at least one)";e.scrollTo(0,0);h=true}}else{if(k=="PIT2"){if(c.pit2SelectedComponents!=undefined&&c.pit2SelectedComponents.length>0){c.versionComponents=c.pit2SelectedComponents}else{a.showSuccessAlert=false;a.showErrorAlert=true;a.errorMessage="Components (must specify at least one)";e.scrollTo(0,0);h=true}}}angular.forEach(c.versionComponents,function(l){c.userRoles.push(k+"_"+l)})}});if(h){return}if(a.isAdmin){c.userRoles.push("ADMIN")}if(a.isRegnAdmin){c.userRoles.push("REGN_ADMIN")}}else{a.showErrorAlert=true;a.errorMessage="PIT Version(s) (must specify at least one)";e.scrollTo(0,0);return}var j={firstName:c.firstName,lastName:c.lastName,emailAddr:c.email,password:c.password,confirmPassword:c.confirmPassword,coNm:c.company,str1Addr:c.streetAddress,cityNm:c.city,stateORTerritory:c.stateOrTerritory,ctryCd:c.country,postalCode:c.postalCode,phnNum:c.phone,bin:c.bin,acquirerBin:c.acquirerBin,allowPAResBatchSbum:c.batchSubmission,allowSubmVIP:c.allowVIP,allowSubmVCMS:c.allowVCMS,pit2Url:c.pit2ACSUrl,acsReference:angular.uppercase(c.acsReference),mrchRefNum:angular.uppercase(c.merchantRefNum),userRoles:c.userRoles,visaComplLetterId:c.visaComplLetterId,tlsVersions:c.selectedTLSVersions,mrchId:c.merchantId,currentPswd:c.currentPswd,businessId:c.businessId};c.loading=true;f.updateUser(j).then(function g(k){c.loading=false;a.showErrorAlert=false;a.showSuccessAlert=true;a.successMessage="Account updated. If you have made any changes, they will be reflected the next time you login. ";e.scrollTo(0,0)},function i(k){c.loading=false;a.showSuccessAlert=false;a.showErrorAlert=true;if(k.data.errorMessage!=null){a.errorMessage=k.data.errorMessage}else{a.errorMessage="Failed to Update the Data"}e.scrollTo(0,0)})};c.resetForm=function(){if(e.confirm("Are you sure you would like to leave the manage profile screen? Any changes will not be saved.")){d.go("PIT2.welcome")}};c.countCheckedComponent=function(){var g=0;angular.forEach(c.pit2components,function(h){if(h.selected){g++}});return g};c.countCheckedVersion=function(){var g=0;angular.forEach(c.versions,function(h){if(h.selected){g++}});return g}}]);