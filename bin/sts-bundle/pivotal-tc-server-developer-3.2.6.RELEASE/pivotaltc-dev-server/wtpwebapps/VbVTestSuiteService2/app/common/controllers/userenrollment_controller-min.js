"use strict";userEnrollmentMod.controller("UserEnrollmentCtrl",["$scope","UserEnrollmentService","$rootScope","$window","$state",function(c,b,a,e,d){a.isManageProfile=false;c.getCountries=function(){b.getCountries().then(function(f){if(f.statusText=="OK"){c.countries=f.data;c.country="840"}else{}})};c.versionSelect=function(f){var g=undefined;if(c.selectedVersions.length>0){angular.forEach(c.selectedVersions,function(h){if(h==f){g=c.selectedVersions.indexOf(f)}});if(g!=undefined){c.selectedVersions.splice(g,1);if(f=="PIT2"){c.resetPIT2Data()}else{c.resetPIT1Data()}}else{c.selectedVersions.push(f);if(f=="PIT2"){c.PIT2Selected=true}else{c.isPIT1=true}}}else{c.selectedVersions.push(f);if(f=="PIT2"){c.PIT2Selected=true}else{c.isPIT1=true}}};c.resetPIT1Data=function(){c.isPIT1=false;c.isACS=false;c.isMPI=false;c.merchantPwd="";c.merchantConfirmPwd="";c.acsVerificationEnrollUrl="";c.selectedComponents=[];angular.forEach(c.components,function(f){f.selected=false})};c.resetPIT2Data=function(){c.PIT2Selected=false;c.isMerchant=false;c.isPIT2ACS=false;c.pit2ACSUrl="";c.acsReference="";c.merchantId="";c.merchantRefNum="";c.pit2SelectedComponents=[];angular.forEach(c.pit2Components,function(f){f.selected=false})};c.tlsVerSelect=function(f){if(c.selectedTLSVersions.length>0){var g=c.selectedTLSVersions.indexOf(f);if(g!=-1){c.selectedTLSVersions.splice(g,1)}else{c.selectedTLSVersions.push(f)}}else{c.selectedTLSVersions.push(f)}angular.forEach(c.tlsVersions,function(h){if(h.id==f){h.selected=!h.selected}});console.log("$scope.selectedTLSVersions.length "+c.selectedTLSVersions.length);return c.selectedTLSVersions.length};c.isMerchant=false;c.isPIT2ACS=false;c.pit2ComponentSelect=function(g){var f;if(c.pit2SelectedComponents.length>0){angular.forEach(c.pit2SelectedComponents,function(h){if(h==g){f=c.pit2SelectedComponents.indexOf(g)}});if(f!=undefined){c.pit2SelectedComponents.splice(f,1);if(g==COMPONENTS.ACS){c.isPIT2ACS=false;c.pit2ACSUrl="";c.acsReference=""}else{if(g==COMPONENTS.MRCH){c.isMerchant=false;c.merchantRefNum="";c.merchantId=""}}}else{c.pit2SelectedComponents.push(g);if(g==COMPONENTS.ACS){c.isPIT2ACS=true}else{if(g==COMPONENTS.MRCH){c.isMerchant=true}}}}else{c.pit2SelectedComponents.push(g);if(g==COMPONENTS.ACS){c.isPIT2ACS=true}else{if(g==COMPONENTS.MRCH){c.isMerchant=true}}}};c.submitUserEnrollment=function(){c.selectedVersions=[];if(c.termsNCond===undefined){c.termsNCond=false}if(c.termsNCond==false){e.alert("Please accept terms and conditions");return}c.userRoles=[];var h=false;c.selectedVersions.push("PIT2");angular.forEach(c.selectedVersions,function(j){if(!h){if(j=="PIT1"){if(c.selectedComponents!=undefined&&c.selectedComponents.length>0){c.versionComponents=c.selectedComponents}else{a.showSuccessAlert=false;a.showErrorAlert=true;a.errorMessage="Components (must specify at least one)";e.scrollTo(0,0);h=true}}else{if(j=="PIT2"){if(c.pit2SelectedComponents!=undefined&&c.pit2SelectedComponents.length>0){c.versionComponents=c.pit2SelectedComponents}else{a.showSuccessAlert=false;a.showErrorAlert=true;a.errorMessage="Components (must specify at least one)";e.scrollTo(0,0);h=true}}}angular.forEach(c.versionComponents,function(k){c.userRoles.push(j+"_"+k)})}});if(h){return}var g={firstName:c.firstName,lastName:c.lastName,emailAddr:angular.lowercase(c.email),password:c.password,confirmPassword:c.confirmPassword,coNm:c.company,str1Addr:c.streetAddress,cityNm:c.city,stateORTerritory:c.stateOrTerritory,ctryCd:c.country,postalCode:c.postalCode,phnNum:c.phone,mrchId:c.merchantId,bin:c.bin,acquirerBin:c.acquirerBin,usrTypCd:c.usrTypCd,tvtscUsrTstApplns:c.selectedVersions,pit2Url:c.pit2ACSUrl,acsReference:angular.uppercase(c.acsReference),actvInd:false,mrchRefNum:angular.uppercase(c.merchantRefNum),userRoles:c.userRoles,visaComplLetterId:c.visaComplLetterId,tlsVersions:c.selectedTLSVersions,acptdTermsInd:c.termsNCond,businessId:c.businessId};c.loading=true;b.submitUserEnrollment(g).then(function f(j){c.loading=false;b.trackingNumber=j.data.trackingNumber;d.go("userEnrollmentSuccess")},function i(j){c.loading=false;a.showSuccessAlert=false;a.showErrorAlert=true;if(j.data.errorMessage!=undefined&&j.data.errorMessage!=null){a.errorMessage=j.data.errorMessage}else{a.errorMessage="Failed to Enroll the user."}e.scrollTo(0,0)})};c.resetForm=function(){c.pit2components=b.getPit2Components();c.versions=b.getVersions();c.tlsVersions=b.getTLSVersions();c.pit2SelectedComponents=[];c.isPIT1=false;c.PIT2Selected=false;c.isACS=false;c.isMPI=false;c.isMerchant=false;c.isPIT2ACS=false;c.termsNCond=false;c.pit2ACSUrl="";c.acsReference="";c.merchantRefNum="";c.merchantId="";a.showErrorAlert=false;a.showSuccessAlert=false;c.selectedTLSVersions=[];angular.forEach(c.tlsVersions,function(f){f.selected=false});c.getCountries()};c.resetForm();c.countCheckedComponent=function(){var f=0;angular.forEach(c.pit2components,function(g){if(g.selected){f++}});return f};c.countCheckedVersion=function(){var f=0;angular.forEach(c.versions,function(g){if(g.selected){f++}});return f}}]);