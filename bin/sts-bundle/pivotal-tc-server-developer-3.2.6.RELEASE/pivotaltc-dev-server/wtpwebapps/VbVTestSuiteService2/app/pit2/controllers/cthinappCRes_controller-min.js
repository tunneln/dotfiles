"use strict";cthModule.controller("CTHinAppCResController",["$scope","$rootScope","$state","$window","CTHRunACSTest","$location","PIT2ReviewService","ValidateCAVVService","$sce",function(j,h,a,b,c,e,d,f,g){j.showCReqDiv=true;j.showVIPBtn=false;j.isACS=false;j.service=c;j.reqUrl=j.service.data.AcsUrl;j.cResMessage=vkbeautify.json(j.service.data.ResponseMessage,2);j.cResMessageObj=angular.fromJson(j.cResMessage);j.isDecode=false;j.showACSHtmlDecode=false;j.challengeDataEntry="";j.updateSuccMsg="";if(j.cResMessageObj!=undefined&&j.cResMessageObj.challengeCompletionInd=="Y"){j.showVIPBtn=true;j.rReqMsg=vkbeautify.json(j.service.data.RReqMsg,2);if(j.rReqMsg!=null&&j.rReqMsg!=undefined){j.rReqMsgObj=angular.fromJson(j.rReqMsg)}j.panNum=j.service.data.panNo;j.expDate=j.service.data.expDate}j.showACSHtml=function(){if(j.cResMessageObj!=undefined&&j.cResMessageObj.acsHTML!=undefined&&j.cResMessageObj.acsHTML!=""){j.showACSHtmlDecode=true}else{j.showACSHtmlDecode=false}};j.showACSHtml();j.reqTestCase=j.service.data.TestcaseNme;j.cmpType=j.service.data.ComponentType;if(j.cmpType=="ACS"||j.cmpType=="ACS_REQUIRED"){j.isACS=true}var i=angular.element(document.querySelector("#respinfoId"));i.html(j.service.data.ResponseInfo);if(j.service.data.AResErrorXmlMsg!=null){j.aresErrorMsg=vkbeautify.json(j.service.data.AResErrorXmlMsg,2)}if(j.service.data.ExpectedResponse!=null){j.expectedResponse=vkbeautify.json(j.service.data.ExpectedResponse,2)}if(j.service.data.CReqMessage!=null){j.cReqMessage=vkbeautify.json(j.service.data.CReqMessage,2)}j.cRequrl=j.service.data.TermUrl;j.cReqName=j.service.data.CReqtcNme;if(j.service.data.CReqtcNme==null||j.service.data.CReqtcNme==""){j.showCReqDiv=false;j.submitBtn=false}else{j.submitBtn=true}j.tcBtn=true;j.runAcsBtn=true;j.submitCReq=function(){j.updateSuccMsg="";j.submitBtn=false;j.tcBtn=false;j.runAcsBtn=false;j.loading=true;j.challengeDataEntry="";j.challengeHtmlDataEntry="";var k={CreqACSURL:j.cRequrl,CreqText:j.cReqMessage,TransactionID:j.service.data.TransactionID,SelectedTestCase:j.service.data.CReqTcId};c.processInappCReq(k).success(function(l){j.service.data=l;j.reqUrl=j.service.data.AcsUrl;j.cResMessage=vkbeautify.json(j.service.data.ResponseMessage,2);j.reqTestCase=j.service.data.TestcaseNme;j.cResMessageObj=angular.fromJson(j.cResMessage);if(j.cResMessageObj.challengeCompletionInd=="Y"){j.showVIPBtn=true;j.rReqMsg=vkbeautify.json(j.service.data.RReqMsg,2);if(j.rReqMsg!=null&&j.rReqMsg!=undefined){j.rReqMsgObj=angular.fromJson(j.rReqMsg)}j.panNum=j.service.data.panNo;j.expDate=j.service.data.expDate}var m=angular.element(document.querySelector("#respinfoId"));m.html(j.service.data.ResponseInfo);if(j.service.data.AResErrorXmlMsg!=null){j.aresErrorMsg=vkbeautify.json(j.service.data.AResErrorXmlMsg,2)}if(j.service.data.ExpectedResponse!=null){j.expectedResponse=vkbeautify.json(j.service.data.ExpectedResponse,2)}if(j.service.data.CReqMessage!=null){j.cReqMessage=vkbeautify.json(j.service.data.CReqMessage,2)}j.cRequrl=j.service.data.TermUrl;j.cReqName=j.service.data.CReqtcNme;if(j.service.data.CReqtcNme==null||j.service.data.CReqtcNme==""){j.showCReqDiv=false;j.submitBtn=false;j.showVIPBtn=true}else{j.submitBtn=true}j.loading=false;j.tcBtn=true;j.runAcsBtn=true;j.showACSHtml()}).error(function(m,l){a.go("PIT2.CTHrunACSTestRes");j.loading=false;j.submitBtn=true})};j.showAcsScrn=function(){a.go("PIT2.RequiredTestCases")};j.tcDetails=function(){j.submitBtn=false;j.runAcsBtn=false;j.tcBtn=false;j.loading=true;var l=j.service.data.TransactionID;var k=j.cmpType;d.reviewTestCase(l,k).success(function(n,m,o){d.data=n;d.cthBckBtn=true;if(k=="ACS"||k=="ACS_REQUIRED"){a.go("PIT2.reviewACS")}else{d.acsBtnForMPI=true;a.go("PIT2.reviewMPI")}}).error(function(n,m){console.log("error blk");a.go("PIT2.RequiredTestCases")})};j.jsonFormat=function(l){if(l=="CRes"){var m=j.cResMessage;j.cResMessage=vkbeautify.json(m,1)}if(l=="expCRes"){var n=j.expectedResponse;j.expectedResponse=vkbeautify.json(n,1)}if(l=="CReq"){var k=j.cReqMessage;j.cReqMessage=vkbeautify.json(k,1)}};j.jsonUnformat=function(l){if(l=="CRes"){var m=j.cResMessage;j.cResMessage=vkbeautify.jsonmin(m)}if(l=="expCRes"){var n=j.expectedResponse;j.expectedResponse=vkbeautify.jsonmin(n)}if(l=="CReq"){var k=j.cReqMessage;j.cReqMessage=vkbeautify.jsonmin(k)}};j.submitToVip=function(){var m={Pan:j.panNum,ExpiryDate:j.expDate,eci:"05",Cavv:j.rReqMsgObj.authenticationValue};j.submitBtn=false;j.tcBtn=false;j.runAcsBtn=false;j.showVIPBtn=false;j.loading=true;f.submitVIPRequest(m).then(function k(n){j.loading=false;f.VIPResponseData=n.data;a.go("PIT2.VIPResults")},function l(n){j.loading=false;j.submitBtn=true;j.tcBtn=true;j.runAcsBtn=true;j.showVIPBtn=true;h.showSuccessAlert=false;h.showErrorAlert=true;if(n.data.errorMessage!=undefined&&n.data.errorMessage!=null){h.errorMessage=n.data.errorMessage}else{h.errorMessage="Error getting results from VIP"}b.scrollTo(0,0)})};j.encodeOrDecodeACSHtml=function(){j.cresJsonObj=angular.fromJson(j.cResMessage);j.acsHtml=j.cresJsonObj.acsHTML;var m={acsHtml:j.acsHtml,decodeACSHtml:j.isDecode};c.decodeACSHtml(m).then(function k(n){j.acsHtmlVal=g.trustAsHtml(n.data)},function l(n){j.cResMessage=vkbeautify.json(JSON.stringify(j.cresJsonObj),2)})};j.closeModal=function(){j.isDecode=false};j.showChallengeDataEntryEditable=false;j.challengeDataEntryField=false;j.challengeHTMLDataEntryField=false;j.challengeHtmlDataEntry="";j.cReqMessageObj=angular.fromJson(j.cReqMessage);if(j.cReqMessageObj!=undefined&&j.cReqMessageObj.challengeDataEntry!=undefined&&j.cReqMessageObj.challengeDataEntry!=""){j.showChallengeDataEntryEditable=true;j.challengeDataEntryField=true}else{j.challengeDataEntryField=false}if(j.cReqMessageObj!=undefined&&j.cReqMessageObj.challengeHTMLDataEntry!=undefined&&j.cReqMessageObj.challengeHTMLDataEntry!=""){j.showChallengeDataEntryEditable=true;j.challengeHTMLDataEntryField=true}else{j.challengeHTMLDataEntryField=false}j.updateTemplateMessage=function(k,l){j.updateSuccMsg="";if(j.challengeDataEntryField){if(k==undefined||k==""){j.updateSuccMsg="";return}if(j.cReqMessageObj.challengeDataEntry!=undefined&&j.cReqMessageObj.challengeDataEntry!=""){j.cReqMessageObj.challengeDataEntry=k;j.cReqMessage=vkbeautify.json(JSON.stringify(j.cReqMessageObj),2);j.updateSuccMsg="Challenge Data Entry value updated successfully"}else{j.cReqMessage=vkbeautify.json(JSON.stringify(j.cReqMessageObj),2);j.updateSuccMsg=""}}else{if(j.challengeHTMLDataEntryField){if(l==undefined||l==""){j.updateSuccMsg="";return}if(j.cReqMessageObj.challengeHTMLDataEntry!=undefined&&j.cReqMessageObj.challengeHTMLDataEntry!=""){j.cReqMessageObj.challengeHTMLDataEntry=l;j.cReqMessage=vkbeautify.json(JSON.stringify(j.cReqMessageObj),2);j.updateSuccMsg="Challenge HTML Data Entry value updated successfully"}else{j.cReqMessage=vkbeautify.json(JSON.stringify(j.cReqMessageObj),2);j.updateSuccMsg=""}}}}}]);