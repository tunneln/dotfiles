"use strict";cthModule.controller("CTHRunACSTestResController",["$scope","$state","CTHRunACSTest","PIT2ReviewService",function(b,c,e,a){b.showCReqDiv=true;b.service=e;b.showVIPBtn=false;b.isACS=false;b.reqUrl=b.service.data.AcsUrl;b.aResMessage=vkbeautify.json(b.service.data.ResponseMessage,2);b.aReqMessage=vkbeautify.json(b.service.data.RequestMessage,2);b.reqTestCase=b.service.data.TestcaseNme;b.cmpType=b.service.data.ComponentType;if(b.cmpType=="ACS"||b.cmpType=="ACS_REQUIRED"){b.isACS=true}b.aResMessageObj=angular.fromJson(b.aResMessage);b.aReqMessageObj=angular.fromJson(b.aReqMessage);if(b.aResMessageObj!=null&&b.aResMessageObj.authenticationValue!=null&&b.aResMessageObj.authenticationValue!=undefined){b.showVIPBtn=true}var d=angular.element(document.querySelector("#respinfoId"));d.html(b.service.data.ResponseInfo);if(b.service.data.AResErrorXmlMsg!=null){b.aresErrorMsg=vkbeautify.json(b.service.data.AResErrorXmlMsg,2)}if(b.service.data.ExpectedResponse!=null){b.expectedResponse=vkbeautify.json(b.service.data.ExpectedResponse,2)}if(b.service.data.CReqMessage!=null){b.cReqMessage=vkbeautify.json(b.service.data.CReqMessage,2)}b.cRequrl=b.service.data.TermUrl;b.cReqName=b.service.data.CReqtcNme;if(b.service.data.CReqtcNme==null||b.service.data.CReqtcNme==""){b.showCReqDiv=false}b.submitBtn=true;b.tcBtn=true;b.runAcsBtn=true;b.submitCReq=function(){b.submitBtn=false;b.tcBtn=false;b.runAcsBtn=false;b.loading=true;var f={CreqACSURL:b.cRequrl,CreqText:b.cReqMessage,TransactionID:b.service.data.TransactionID,SelectedTestCase:b.service.data.CReqTcId};if(b.service.data.DeviceType=="02"){e.reviewCReq(f).then(function(g){b.service.CReqCompressedData=g.data;c.go("PIT2.CTHreviewCReq")})}if(b.service.data.DeviceType=="01"){e.processInappCReq(f).success(function(g){b.service.data=g;c.go("PIT2.CTHinAppCReqResponse")}).error(function(h,g){c.go("PIT2.CTHrunACSTestRes");b.loading=false;b.submitBtn=true})}};b.showAcsScrn=function(){c.go("PIT2.RequiredTestCases")};b.tcDetails=function(){a.noTestCases=false;b.submitBtn=false;b.runAcsBtn=false;b.tcBtn=false;b.loading=true;var g=b.service.data.TransactionID;var f=b.cmpType;a.reviewTestCase(g,f).success(function(i,h,j){a.data=i;a.cthBckBtn=true;if(f=="ACS"||f=="ACS_REQUIRED"){c.go("PIT2.reviewACS")}else{a.acsBtnForMPI=true;if(i!=null&&i!=undefined&&i!=""){c.go("PIT2.reviewMPI")}else{a.noTestCases=true;c.go("PIT2.reviewMPI")}}}).error(function(i,h){c.go("PIT2.RequiredTestCases")})};b.jsonFormat=function(h){if(h=="ARes"){var i=b.aResMessage;b.aResMessage=vkbeautify.json(i,1)}if(h=="expARes"){var g=b.aResMessage;b.aResMessage=vkbeautify.json(g,1)}if(h=="CReq"){var f=b.cReqMessage;b.cReqMessage=vkbeautify.json(f,1)}};b.jsonUnformat=function(h){if(h=="ARes"){var i=b.aResMessage;b.aResMessage=vkbeautify.jsonmin(i)}if(h=="expARes"){var g=b.expectedResponse;b.expectedResponse=vkbeautify.jsonmin(g)}if(h=="CReq"){var f=b.cReqMessage;b.cReqMessage=vkbeautify.jsonmin(f)}};b.submitToVip=function(){var h={Pan:b.aReqMessageObj.acctNumber,ExpiryDate:b.aReqMessageObj.cardExpiryDate,eci:"05",Cavv:b.aResMessageObj.authenticationValue};b.submitBtn=false;b.runAcsBtn=false;b.tcBtn=false;b.showVIPBtn=false;b.loading=true;ValidateCAVVService.submitVIPRequest(h).then(function f(i){b.loading=false;ValidateCAVVService.VIPResponseData=i.data;c.go("PIT2.VIPResults")},function g(i){b.submitBtn=true;b.runAcsBtn=true;b.tcBtn=true;b.showVIPBtn=true;b.loading=false;$rootScope.showSuccessAlert=false;$rootScope.showErrorAlert=true;if(i.data.errorMessage!=undefined&&i.data.errorMessage!=null){$rootScope.errorMessage=i.data.errorMessage}else{$rootScope.errorMessage="Error getting results from VIP"}$window.scrollTo(0,0)})}}]);