"use strict";var mpiAResMod=angular.module("MPIAResModule",[]);mpiAResMod.controller("MPIAResCtrl",["$scope","AdministerTestsServicePIT2","$rootScope","$window",function(c,b,a,d){c.loading=false;c.pageloaded=true;c.componentType="MPI";c.applnId="PIT2";c.msgType="ARes";c.testCaseType="02";c.selectedTestCase;c.testCaseName;c.pan;c.successorCResTC;c.requiredByRegion;c.pitAction;c.aResTemplate;c.cResTemplates={};c.compliance;c.previousTestCase;c.selectedRegions=[];c.aReqMandFields;c.regions=[{value:"U.S.A",rgnCd:"01",flag:false},{value:"CANADA",rgnCd:"02",flag:false},{value:"E.U.",rgnCd:"03",flag:false},{value:"ASIAPAC",rgnCd:"04",flag:false},{value:"LAT.AM.",rgnCd:"05",flag:false},{value:"C.E.M.E.A.",rgnCd:"06",flag:false}];c.pitActions=["None","No Response From Visa Directory Server"];c.selectedTestCaseObj={};c.optionExpectedRes;c.actionTemplates=[];c.selectedExpResps=[];c.cResSuccessorIdTCs=[];c.isExistingTC=false;c.getTestCases=function(f,e){c.tcResData=[];c.testCases=[];c.actionTemplates=[];b.getTestCases(f,e).then(function(g){c.tcResData=g.data;if(c.tcResData.length>0){if(g.data[0].testCaseId!=null&&g.data[0].testCaseId!=undefined&&g.data[0].testCaseId!=""){c.isExistingTC=true;angular.forEach(c.tcResData,function(i){c.testCases.push({tcId:i.testCaseId,tcDesc:i.tc_desc})});if(c.previousTestCase>0||c.previousTestCase!=null){var h=c.tcResData.map(function(i){return i.testCaseId}).indexOf(c.previousTestCase);c.selectedTestCaseObj=c.tcResData[h];c.setData(c.selectedTestCaseObj);c.previousTestCase=null}else{c.selectedTestCaseObj=c.tcResData[0];c.setData(c.selectedTestCaseObj)}}else{c.isExistingTC=false;c.pageloaded=false;c.pitAction="None";c.aResTemplate="";c.aReqMandFields="";c.cResSuccessorIdTCs=c.tcResData[0].successorIdTCs}}else{if(c.tcResData.length==0){c.isExistingTC=false;c.pageloaded=false;c.pitAction="None";c.aResTemplate="";c.aReqMandFields=""}else{c.isExistingTC=false}}})};c.getTestCases(c.msgType,c.testCaseType);c.setData=function(e){c.expectedResMsg=[];c.selectedExpResps=[];c.compliance=e.compliance;c.selectedTestCase=e.testCaseId;c.testCaseName=e.tcName;c.successorCResTC=e.selectedSuccessorId;c.expectedResMsg=e.expctdRespAcs;c.aReqMandFields=e.expctdMpiReqFields;if(e.tcActionTmpl.length>0){c.pitAction=e.tcActionTmpl[0].actnTemplName}if(e.region.length>0){c.selectedRegions=[];angular.forEach(e.region,function(f){c.selectedRegions.push(f.regnCd)});angular.forEach(c.regions,function(f){if(c.selectedRegions.indexOf(f.rgnCd)!=-1){f.flag=true}else{f.flag=false}})}else{c.selectedRegions=[];angular.forEach(c.regions,function(f){f.flag=false})}if(e.expectedMshg.length>0){angular.forEach(e.expectedMshg,function(f){c.selectedExpResps.push(f.exptRespDesc)})}c.cResSuccessorIdTCs=e.successorIdTCs;c.pan=e.pan;c.aResTemplate=vkbeautify.json(e.templeteMsg,1);c.pageloaded=false};c.changeTCResData=function(f){var e=c.tcResData.map(function(g){return g.testCaseId}).indexOf(f);if(e!=-1){c.isExistingTC=true;c.selectedTestCaseObj=c.tcResData[e];c.setData(c.selectedTestCaseObj)}else{c.isExistingTC=false;c.selectedTestCase="";c.testCaseName="";c.pitAction="None";c.pan="";c.aResTemplate="";c.selectedRegions=[];c.expectedResMsg="";c.actionTemplates=[];c.selectedExpResps=[];c.successorCResTC="";c.aReqMandFields="";angular.forEach(c.regions,function(g){g.flag=false})}};c.selectedRegion=function(f){if(c.selectedRegions.length>0){var e;angular.forEach(c.selectedRegions,function(g){if(g===f){e=c.selectedRegions.indexOf(g)}});if(e!=undefined){c.selectedRegions.splice(e,1)}else{c.selectedRegions.push(f)}}else{c.selectedRegions.push(f)}};c.jsonFormat=function(g){if(g=="ARes"){var e=c.aResTemplate;c.aResTemplate=vkbeautify.json(e,1)}if(g=="expAResResp"){var f=c.expectedResMsg;c.expectedResMsg=vkbeautify.json(f,1)}};c.jsonUnformat=function(g){if(g=="ARes"){var e=c.aResTemplate;c.aResTemplate=vkbeautify.jsonmin(e)}if(g=="expAResResp"){var f=c.expectedResMsg;c.expectedResMsg=vkbeautify.jsonmin(f)}};c.mpiAResSubmit=function(f,g){c.actionTemplates=[];c.actionTemplates.push(c.pitAction);var h={operationType:f,testCaseId:c.selectedTestCase,tcName:c.testCaseName,templeteMsg:c.aResTemplate,pan:c.pan,regnCds:c.selectedRegions,actnTemplName:c.actionTemplates,expctdRespAcs:c.expectedResMsg,exptRespDesc:c.selectedExpResps,selectedSuccessorId:c.successorCResTC,componentType:c.componentType,applnId:c.applnId,msgType:c.msgType,deviceChannel:c.testCaseType,compliance:c.compliance,expctdMpiReqFields:c.aReqMandFields};c.loading=true;b.createNewTestCase(h).then(function(i){c.loading=false;c.getTestCases(c.msgType,c.testCaseType);a.showErrorAlert=false;a.showSuccessAlert=true;if(f=="create"){a.successMessage="3DS ARes Browser test case  '"+c.testCaseName+"' created"}else{if(f=="update"){a.successMessage="3DS ARes Browser test case '"+c.testCaseName+"' updated";c.previousTestCase=c.selectedTestCase}else{if(f=="delete"){a.successMessage="3DS ARes Browser test case  '"+c.testCaseName+"' deleted"}}}d.scrollTo(0,0)},function e(i){c.loading=false;a.showSuccessAlert=false;a.showErrorAlert=true;if(i.data.errorMessage!=null){a.errorMessage=i.data.errorMessage}else{a.errorMessage="Transaction Failed"}d.scrollTo(0,0)})};c.deleteConfirm=function(){if(d.confirm("Are you sure you want to delete '"+c.testCaseName+"' test case")){c.mpiAResSubmit("delete")}}}]);