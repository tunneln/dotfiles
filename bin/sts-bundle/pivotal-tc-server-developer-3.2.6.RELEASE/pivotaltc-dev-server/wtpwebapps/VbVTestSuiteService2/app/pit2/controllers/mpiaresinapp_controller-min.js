"use strict";var mpiAResInAppMod=angular.module("MPIAResInAppModule",[]);mpiAResInAppMod.controller("MPIAResInAppCtrl",["$scope","AdministerTestsServiceInappPIT2","$rootScope","$window",function(b,d,a,c){b.loading=false;b.pageloaded=true;b.componentType="MPI";b.applnId="PIT2";b.msgType="ARes";b.testCaseType="01";b.selectedTestCase;b.testCaseName;b.requiredByRegion;b.pan;b.pitAction;b.aResTemplate;b.compliance;b.previousTestCase;b.selectedRegions=[];b.actionTemplates=[];b.successorCResTC=[];b.aResTemplate={};b.aReqMandFields;b.regions=[{value:"U.S.A",rgnCd:"01",flag:false},{value:"CANADA",rgnCd:"02",flag:false},{value:"E.U.",rgnCd:"03",flag:false},{value:"ASIAPAC",rgnCd:"04",flag:false},{value:"LAT.AM.",rgnCd:"05",flag:false},{value:"C.E.M.E.A.",rgnCd:"06",flag:false}];b.pitActions=["None","No Response From Visa Directory Server"];b.selectedTestCaseObj={};b.isExistingTC=false;b.cResSuccessorIdTCs=[];b.getTestCases=function(f,e){b.tcResData=[];b.testCases=[];d.getTestCases(f,e).then(function(g){b.tcResData=g.data;if(b.tcResData.length>0){if(g.data[0].testCaseId!=null&&g.data[0].testCaseId!=undefined&&g.data[0].testCaseId!=""){b.isExistingTC=true;angular.forEach(b.tcResData,function(i){b.testCases.push({tcId:i.testCaseId,tcDesc:i.tc_desc})});if(b.previousTestCase>0||b.previousTestCase!=null){var h=b.tcResData.map(function(i){return i.testCaseId}).indexOf(b.previousTestCase);b.selectedTestCaseObj=b.tcResData[h];b.setData(b.selectedTestCaseObj);b.previousTestCase=null}else{b.selectedTestCaseObj=b.tcResData[0];b.setData(b.selectedTestCaseObj)}}else{b.isExistingTC=false;b.pageloaded=false;b.pitAction="None";b.aResTemplate="";b.aReqMandFields="";b.cResSuccessorIdTCs=b.tcResData[0].successorIdTCs}}else{if(b.tcResData.length==0){b.isExistingTC=false;b.pageloaded=false;b.pitAction="None";b.aResTemplate="";b.aReqMandFields=""}else{b.isExistingTC=false}}})};b.getTestCases(b.msgType,b.testCaseType);b.setData=function(e){b.selectedTestCase=e.testCaseId;b.testCaseName=e.tcName;b.compliance=e.compliance;b.aReqMandFields=e.expctdMpiReqFields;console.log("successor CRes :: "+e.successorIdTCs);console.log("successor CRes length :: "+e.successorIdTCs.length);if(e.tcActionTmpl.length>0){b.pitAction=e.tcActionTmpl[0].actnTemplName}else{b.pitAction="None"}if(e.region.length>0){b.selectedRegions=[];angular.forEach(e.region,function(f){b.selectedRegions.push(f.regnCd)});angular.forEach(b.regions,function(f){if(b.selectedRegions.indexOf(f.rgnCd)!=-1){f.flag=true}else{f.flag=false}})}else{b.selectedRegions=[];angular.forEach(b.regions,function(f){f.flag=false})}b.cResSuccessorIdTCs=e.successorIdTCs;b.successorCResTC=e.selectedSuccIdTCs;b.pan=e.pan;b.aResTemplate=vkbeautify.json(e.templeteMsg,1);b.pageloaded=false};b.changeTCReqData=function(f){var e=b.tcResData.map(function(g){return g.testCaseId}).indexOf(f);if(e!=-1){b.isExistingTC=true;b.selectedTestCaseObj=b.tcResData[e];b.setData(b.selectedTestCaseObj)}else{b.isExistingTC=false;b.selectedTestCase="";b.testCaseName="";b.successorCResTC=[];b.pan="";b.pitAction="None";b.aResTemplate="";b.aReqMandFields="";b.selectedRegions=[];angular.forEach(b.regions,function(g){g.flag=false})}};b.jsonFormat=function(g){if(g=="ARes"){var e=b.aResTemplate;b.aResTemplate=vkbeautify.json(e,1)}if(g=="expAResResp"){var f=b.expectedResMsg;b.expectedResMsg=vkbeautify.json(f,1)}};b.jsonUnformat=function(g){if(g=="ARes"){var e=b.aResTemplate;b.aResTemplate=vkbeautify.jsonmin(e)}if(g=="expAResResp"){var f=b.expectedResMsg;b.expectedResMsg=vkbeautify.jsonmin(f)}};b.selectedRegion=function(f){if(b.selectedRegions.length>0){var e;angular.forEach(b.selectedRegions,function(g){if(g===f){e=b.selectedRegions.indexOf(g)}});if(e!=undefined){b.selectedRegions.splice(e,1)}else{b.selectedRegions.push(f)}}else{b.selectedRegions.push(f)}};b.mpiAResSubmit=function(g,h){console.log("selected CRes tcs ====== "+b.successorCResTC);b.actionTemplates=[];b.actionTemplates.push(b.pitAction);var i={operationType:g,testCaseId:b.selectedTestCase,tcName:b.testCaseName,successorIdTCs:b.successorCResTC,pan:b.pan,templeteMsg:b.aResTemplate,regnCds:b.selectedRegions,actnTemplName:b.actionTemplates,componentType:b.componentType,applnId:b.applnId,msgType:b.msgType,deviceChannel:b.testCaseType,compliance:b.compliance,expctdMpiReqFields:b.aReqMandFields};console.log("selected successorids in data object :: "+i.successorIdTCs);b.loading=true;d.createNewTestCase(i).then(function e(j){b.loading=false;console.log("Status of the test case txn : "+j.status);console.log("Test case created successfully");b.getTestCases(b.msgType,b.testCaseType);a.showErrorAlert=false;a.showSuccessAlert=true;if(g=="create"){a.successMessage="3DS ARes InApp test case '"+b.testCaseName+"' created"}else{if(g=="update"){a.successMessage="3DS ARes InApp test case '"+b.testCaseName+"' updated";b.previousTestCase=b.selectedTestCase}else{if(g=="delete"){a.successMessage="3DS ARes InApp test case '"+b.testCaseName+"' deleted"}}}c.scrollTo(0,0)},function f(j){b.loading=false;console.log("Test case creation Failed");a.showSuccessAlert=false;a.showErrorAlert=true;if(j.data.errorMessage!=null){a.errorMessage=j.data.errorMessage}else{a.errorMessage="Transaction Failed"}c.scrollTo(0,0)})};b.deleteConfirm=function(){if(c.confirm("Are you sure you want to delete '"+b.testCaseName+"' test case")){b.mpiAResSubmit("delete")}}}]);