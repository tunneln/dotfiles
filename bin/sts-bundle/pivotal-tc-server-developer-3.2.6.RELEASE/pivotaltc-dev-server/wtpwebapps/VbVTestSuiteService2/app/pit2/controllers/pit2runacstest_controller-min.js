"use strict";runACSTestCtrlMod.controller("PIT2RunACSTestController",["$scope","PIT2RunACSTest","$state","$rootScope",function(b,d,c,a){b.pageLoading=false;b.submitBtn=true;b.testCases=[];b.service=d;b.panNumber="";b.cardExpiryDate="";a.isMPITesting=false;b.updateSuccMsg="";b.getRequestForm=function(){d.getTestCases().then(function(e){b.testCases=e.Testcaseslist;b.url=e.AcsUrl;if(a.check==true){b.selectedTestCase=a.tcID;b.change(b.selectedTestCase);a.check=false}else{if(e.Testcaseslist!=null){b.selectedTestCase=e.Testcaseslist[0].tcID;b.AReq=vkbeautify.json(e.Testcaseslist[0].templateMsg,2)}}b.pageloaded=false})};b.selectedTCData={};b.urlChange=function(){if(b.url!=undefined){var e=b.url.split("/");if(e.length>0){var f="/"+e[e.length-2]+"/"+e[e.length-1];if(f!=undefined&&f=="/DS2/authenticate"){a.isMPITesting=true}else{a.isMPITesting=false}}else{a.isMPITesting=false}}else{a.isMPITesting=false}};b.setTestCaseData=function(){b.pageLoading=true;b.selectedTCData=b.service.selectedTCData;b.url=b.selectedTCData.acsUrl;b.selectedTCName=b.selectedTCData.testcaseName;b.AReq=b.selectedTCData.AReq;b.selectedTCId=b.selectedTCData.testcaseId;b.pageLoading=false;b.urlChange()};b.setTestCaseData();b.change=function(e){if(e!=null){d.getAReq(e).then(function(f){b.AReq=vkbeautify.json(f.data.RequestMessage,2)})}else{b.AReq=""}};b.submitAReq=function(){var e=true;var f=b.url;var g=f.replace(/\<|\>|\"|\#|\'|%|\;|\(|\)|\&|\+|\-/g,"");if(f.length!=g.length){a.showErrorAlert=true;a.errorMessage="ACS URL should not contain )(#&><\"'%;+- characters";e=false}if(e){b.submitBtn=false;b.loading=true;d.submitAReq(b.url,b.selectedTCId,b.AReq).success(function(h){b.service.data=h;b.service.reqTestCase=b.selectedTCId;c.go("PIT2.runACSTestResPIT2")}).error(function(i,h){c.go("PIT2.PIT2runACSTest");b.loading=false;b.submitBtn=true})}};b.updateTemplateMessage=function(e,f){console.log("pan number : "+e);console.log("Card expiry date : "+f);b.panNumber=e;b.cardExpiryDate=f;if(b.AReq!=undefined&&b.AReq!=""){b.AReqJSONObj=angular.fromJson(b.AReq);if(b.panNumber!=undefined&&b.panNumber!=""){b.AReqJSONObj.acctNumber=b.panNumber}if(b.cardExpiryDate!=undefined&&b.cardExpiryDate!=""){b.AReqJSONObj.cardExpiryDate=b.cardExpiryDate}if((b.panNumber!=undefined&&b.panNumber!="")&&(b.cardExpiryDate==undefined||b.cardExpiryDate=="")){b.updateSuccMsg="Account # value updated successfully"}else{if((b.cardExpiryDate!=undefined&&b.cardExpiryDate!="")&&(b.panNumber==undefined||b.panNumber=="")){b.updateSuccMsg="Expiry Date value updated successfully"}else{if((b.panNumber!=undefined&&b.panNumber!="")&&(b.cardExpiryDate!=undefined&&b.cardExpiryDate!="")){b.updateSuccMsg="Account # and Expiry Date values updated successfully"}else{b.updateSuccMsg=""}}}}b.AReq=vkbeautify.json(JSON.stringify(b.AReqJSONObj),2)};b.jsonFormat=function(){var e=b.AReq;b.AReq=vkbeautify.json(e,2)};b.jsonUnformat=function(){var e=b.AReq;b.AReq=vkbeautify.jsonmin(e)};b.backToTestCaseSelection=function(){b.onlyACS=b.service.onlyACS;if(b.onlyACS==true){c.go("PIT2.OptionalTestCases")}else{c.go("PIT2.OptionalACS3DSTestCases")}}}]);