"use strict";var reviewCResMod=angular.module("ReviewCResModule",[]);reviewCResMod.controller("RevewCResCtrl",["$scope","CResService","$rootScope","$state","$window","PIT2ReviewService","ValidateCAVVService",function(d,c,b,e,g,a,f){d.service=c;d.submitBtn=true;d.tcBtn=true;d.runAcsBtn=true;d.isPageLoading=false;d.showVIPBtn=false;d.isACS=false;d.noCResMsg=false;d.getCRes=function(h){console.log("transId "+h);d.isPageLoading=true;c.getCRes(h).success(function(j,i){d.isPageLoading=false;d.testCase=j.testCase;console.log("$scope.testCase",+d.testCase);d.testCaseResults=j.testCaseResults;d.cmpType=j.compType;if(d.cmpType=="ACS"||d.cmpType=="ACS_REQUIRED"){d.isACS=true}d.cResMessage=vkbeautify.json(j.cResMessage,2);d.cResMessageObj=angular.fromJson(d.cResMessage);if(d.cResMessageObj.transStatus=="Y"||d.cResMessageObj.transStatus=="A"){d.showVIPBtn=true}d.rReqMsg=vkbeautify.json(j.rReqMsg,2);if(d.rReqMsg!=null&&d.rReqMsg!=undefined){d.rReqMsgObj=angular.fromJson(d.rReqMsg)}d.panNum=j.panNo;d.expDate=j.expDate;d.payerAuthUrl=j.payerAuthUrl;var k=angular.element(document.querySelector("#respinfoId"));k.html(j.validationRespMsg);d.allowVIPsubmit=j.allowVIPsubmit;d.transactionID=j.transactionId;if(j.expectedResponse!=null){d.expectedResponse=vkbeautify.json(j.expectedResponse,2)}if(j.errResponseMsg!=null){var m=j.errResponseMsg;var l=m.substring(0,m.length-1);d.errResponseMsg=l}}).error(function(j,i){d.isPageLoading=false;console.log("error blk");d.noCResMsg=true})};d.getCRes(b.txnId);d.jsonFormat=function(){var h=d.cResMessage;d.cResMessage=vkbeautify.json(h,1)};d.jsonUnformat=function(){var h=d.cResMessage;d.cResMessage=vkbeautify.jsonmin(h)};d.expjsonFormat=function(){var h=d.expectedResponse;d.expectedResponse=vkbeautify.json(h,1)};d.expjsonUnformat=function(){var h=d.expectedResponse;d.expectedResponse=vkbeautify.jsonmin(h)};d.showAcsScrn=function(){d.runAcsBtn=false;d.showVIPBtn=false;d.loading=true;e.go("PIT2.OptionalTestCases")};d.tcDetails=function(){d.submitBtn=false;d.runAcsBtn=false;d.tcBtn=false;d.showVIPBtn=false;d.loading=true;var i=d.transactionID;var h=d.cmpType;a.reviewTestCase(i,h).success(function(k,j,l){a.data=k;a.backBtn=true;if(h=="ACS"||h=="ACS_REQUIRED"){e.go("PIT2.reviewACS")}else{a.acsBtnForMPI=true;e.go("PIT2.reviewMPI")}}).error(function(k,j){console.log("error blk");e.go("PIT2.OptionalTestCases")})};d.submitToVip=function(){var j={Pan:d.panNum,ExpiryDate:d.expDate,eci:"05",Cavv:d.rReqMsgObj.authenticationValue};d.submitBtn=false;d.runAcsBtn=false;d.tcBtn=false;d.showVIPBtn=false;d.loading=true;f.submitVIPRequest(j).then(function h(k){d.loading=false;f.VIPResponseData=k.data;e.go("PIT2.VIPResults")},function i(k){d.loading=false;d.submitBtn=true;d.tcBtn=true;d.runAcsBtn=true;d.showVIPBtn=true;b.showSuccessAlert=false;b.showErrorAlert=true;if(k.data.errorMessage!=undefined&&k.data.errorMessage!=null){b.errorMessage=k.data.errorMessage}else{b.errorMessage="Error getting results from VIP"}g.scrollTo(0,0)})}}]);