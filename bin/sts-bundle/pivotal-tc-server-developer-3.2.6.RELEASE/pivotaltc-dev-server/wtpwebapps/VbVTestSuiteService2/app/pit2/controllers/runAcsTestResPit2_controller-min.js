"use strict";var pit2runACSTestResCtrlMod=angular.module("PIT2RunACSTestResCtrlModule",[]);pit2runACSTestResCtrlMod.controller("PIT2RunACSTestResController",["$scope","$state","$rootScope","$window","PIT2RunACSTest","PIT2ReviewService","ValidateCAVVService",function(c,d,b,h,g,a,f){c.showCReqDiv=true;c.showVIPBtn=false;c.isACS=false;c.service=g;c.reqUrl=c.service.data.AcsUrl;c.cmpType=c.service.data.ComponentType;if(c.cmpType=="ACS"||c.cmpType=="ACS_REQUIRED"){c.isACS=true}c.aResMessage=vkbeautify.json(c.service.data.ResponseMessage,2);c.reqTestCase=c.service.data.TestcaseNme;c.aReqMessage=vkbeautify.json(c.service.data.RequestMessage,2);c.aResMessageObj=angular.fromJson(c.aResMessage);c.aReqMessageObj=angular.fromJson(c.aReqMessage);if(c.aResMessageObj!=null&&c.aResMessageObj.authenticationValue!=null&&c.aResMessageObj.authenticationValue!=undefined){c.showVIPBtn=true}var e=angular.element(document.querySelector("#respinfoId"));e.html(c.service.data.ResponseInfo);if(c.service.data.AResErrorXmlMsg!=null){c.aresErrorMsg=vkbeautify.json(c.service.data.AResErrorXmlMsg,2)}if(c.service.data.ExpectedResponse!=null){c.expectedResponse=vkbeautify.json(c.service.data.ExpectedResponse,2)}if(c.service.data.CReqMessage!=null){c.cReqMessage=vkbeautify.json(c.service.data.CReqMessage,2)}c.cRequrl=c.service.data.TermUrl;c.cReqName=c.service.data.CReqtcNme;if(c.service.data.CReqtcNme==null||c.service.data.CReqtcNme==""){c.showCReqDiv=false}c.submitBtn=true;c.tcBtn=true;c.runAcsBtn=true;c.submitCReq=function(){c.submitBtn=false;c.tcBtn=false;c.runAcsBtn=false;c.showVIPBtn=false;c.loading=true;var i={CreqACSURL:c.cRequrl,CreqText:c.cReqMessage,TransactionID:c.service.data.TransactionID,SelectedTestCase:c.service.data.CReqTcId};if(c.service.data.DeviceType=="02"){g.reviewCReq(i).then(function(j){c.service.CReqCompressedData=j.data;d.go("PIT2.reviewCReq")})}if(c.service.data.DeviceType=="01"){g.processInappCReq(i).success(function(j){c.service.data=j;d.go("PIT2.inAppCReqResponse")}).error(function(k,j){d.go("PIT2.runACSTestResPIT2");c.loading=false;c.submitBtn=true})}};c.showAcsScrn=function(){d.go("PIT2.OptionalTestCases")};c.tcDetails=function(){a.noTestCases=false;c.submitBtn=false;c.runAcsBtn=false;c.tcBtn=false;c.showVIPBtn=false;c.loading=true;var j=c.service.data.TransactionID;var i=c.cmpType;a.reviewTestCase(j,i).success(function(l,k,m){a.data=l;a.backBtn=true;if(i=="ACS"||i=="ACS_REQUIRED"){d.go("PIT2.reviewACS")}else{a.acsBtnForMPI=true;if(l!=null&&l!=undefined&&l!=""){d.go("PIT2.reviewMPI")}else{a.noTestCases=true;d.go("PIT2.reviewMPI")}}}).error(function(l,k){d.go("PIT2.OptionalTestCases")})};c.jsonFormat=function(k){if(k=="ARes"){var l=c.aResMessage;c.aResMessage=vkbeautify.json(l,1)}if(k=="expARes"){var j=c.aResMessage;c.aResMessage=vkbeautify.json(j,1)}if(k=="CReq"){var i=c.cReqMessage;c.cReqMessage=vkbeautify.json(i,1)}};c.jsonUnformat=function(k){if(k=="ARes"){var l=c.aResMessage;c.aResMessage=vkbeautify.jsonmin(l)}if(k=="expARes"){var j=c.expectedResponse;c.expectedResponse=vkbeautify.jsonmin(j)}if(k=="CReq"){var i=c.cReqMessage;c.cReqMessage=vkbeautify.jsonmin(i)}};c.submitToVip=function(){var k={Pan:c.aReqMessageObj.acctNumber,ExpiryDate:c.aReqMessageObj.cardExpiryDate,eci:"05",Cavv:c.aResMessageObj.authenticationValue};c.submitBtn=false;c.runAcsBtn=false;c.tcBtn=false;c.showVIPBtn=false;c.loading=true;f.submitVIPRequest(k).then(function i(l){c.loading=false;f.VIPResponseData=l.data;d.go("PIT2.VIPResults")},function j(l){c.submitBtn=true;c.runAcsBtn=true;c.tcBtn=true;c.showVIPBtn=true;c.loading=false;b.showSuccessAlert=false;b.showErrorAlert=true;if(l.data.errorMessage!=undefined&&l.data.errorMessage!=null){b.errorMessage=l.data.errorMessage}else{b.errorMessage="Error getting results from VIP"}h.scrollTo(0,0)})}}]);